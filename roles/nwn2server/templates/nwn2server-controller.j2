#!/bin/bash

if [ "$1" == "start" ]; then
	CMD="C:/Users/Administrator/Desktop/nwn2server-start.bat"
elif [ "$1" == "stop" ]; then
	CMD="psexec -nobanner -i 1 -s taskkill /IM nwn2server.exe && psexec -nobanner -i 1 -s taskkill /IM NWNX4_GUI.exe"
elif [ "$1" == "kill" ]; then
	CMD="taskkill /IM nwn2server.exe /F"
elif [ "$1" == "restart" ]; then
	CMD="psexec -nobanner -i 1 -s taskkill /IM nwn2server.exe"
elif [ "$1" == "cmd" ]; then
	CMD="$2"
else
	echo "Usage: $0 (start|stop|kill|restart|cmd)"
	echo "  cmd example: $0 cmd tasklist"
	exit 1
fi


python2 -c "
import winrm
import sys
session = winrm.Session('127.0.0.1:{{winrm_port}}', auth=('{{windows_user}}','{{windows_password}}'))
print(\"exec: $CMD\")
try:
	result = session.run_cmd(\"$CMD\")
	print('\x1b[31m' + result.std_err.decode('utf-8') + '\x1b[0m')
	print(result.std_out.decode('utf-8'))
except:
	print(sys.exc_info())
	sys.exit(-1)
sys.exit(result.status_code)
"
